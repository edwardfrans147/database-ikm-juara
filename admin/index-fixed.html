<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - IKM JUARA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../shared/style.css" rel="stylesheet">
    <style>
        .dashboard-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .dashboard-card h3 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .dashboard-card p {
            margin: 0;
            opacity: 0.9;
        }
        
        .dashboard-card i {
            font-size: 3rem;
            opacity: 0.3;
            position: absolute;
            right: 20px;
            top: 20px;
        }
        
        .card-ikm { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hki { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .card-halal { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .card-tkdn { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .card-siinas { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .card-gizi { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .card-kurasi { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .card-pelatihan { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .card-peserta { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .welcome-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .welcome-section h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .welcome-section p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="sidebar-header">
                        <h4><i class="fas fa-industry"></i> IKM JUARA</h4>
                        <p>Dashboard Admin IKM Binaan Madiun</p>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link menu-item active" id="menu-dashboard" href="index.html">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link menu-item" id="menu-ikm-binaan" href="ikm-binaan.html">
                                <i class="fas fa-building"></i> IKM Binaan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link menu-item" id="menu-inputan-layanan" href="inputan-layanan.html">
                                <i class="fas fa-plus-circle"></i> Inputan Layanan IKM
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link menu-item" id="menu-layanan-ikm" href="layanan-ikm.html">
                                <i class="fas fa-cogs"></i> Layanan IKM Juara
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link menu-item" id="menu-pelatihan" href="pelatihan.html">
                                <i class="fas fa-graduation-cap"></i> Pelatihan Pemberdayaan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link menu-item" id="menu-penelusuran" href="penelusuran.html">
                                <i class="fas fa-search"></i> Penelusuran Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link menu-item" id="menu-edit-redaksi" href="edit-redaksi.html">
                                <i class="fas fa-edit"></i> Edit Redaksi Website
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link menu-item" id="menu-activity-logs" href="activity-logs.html">
                                <i class="fas fa-history"></i> Activity Logs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link menu-item" id="menu-recycle" href="recycle-bin.html">
                                <i class="fas fa-trash-restore"></i> Recycle Bin
                            </a>
                        </li>
                    </ul>
                    
                    <div class="sidebar-footer">
                        <div class="user-info">
                            <i class="fas fa-user-circle"></i>
                            <span id="user-name">Admin</span>
                        </div>
                        <button class="btn btn-outline-light btn-sm" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2"><i class="fas fa-tachometer-alt"></i> Dashboard IKM JUARA</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="loadDashboardData()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Welcome Section -->
                <div class="welcome-section">
                    <h1><i class="fas fa-chart-line"></i> Selamat Datang di Dashboard IKM JUARA</h1>
                    <p>Kelola data IKM binaan dan layanan pemberdayaan dengan mudah</p>
                </div>

                <!-- Dashboard Statistics -->
                <div class="stats-grid">
                    <!-- IKM Binaan -->
                    <div class="dashboard-card card-ikm position-relative">
                        <i class="fas fa-building"></i>
                        <h3 id="ikm-binaan">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>IKM Binaan</p>
                        <small>Total IKM yang terdaftar</small>
                    </div>

                    <!-- HKI Merek -->
                    <div class="dashboard-card card-hki position-relative">
                        <i class="fas fa-certificate"></i>
                        <h3 id="hki-merek">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>HKI Merek</p>
                        <small>Sertifikat HKI yang diproses</small>
                    </div>

                    <!-- Sertifikat Halal -->
                    <div class="dashboard-card card-halal position-relative">
                        <i class="fas fa-check-circle"></i>
                        <h3 id="sertifikat-halal">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>Sertifikat Halal</p>
                        <small>Produk bersertifikat halal</small>
                    </div>

                    <!-- TKDN IK -->
                    <div class="dashboard-card card-tkdn position-relative">
                        <i class="fas fa-flag"></i>
                        <h3 id="tkdn-ik">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>TKDN IK</p>
                        <small>Sertifikat TKDN yang diproses</small>
                    </div>

                    <!-- SIINAS -->
                    <div class="dashboard-card card-siinas position-relative">
                        <i class="fas fa-shield-alt"></i>
                        <h3 id="siinas">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>SIINAS</p>
                        <small>Sertifikat SIINAS yang diproses</small>
                    </div>

                    <!-- Uji Nilai Gizi -->
                    <div class="dashboard-card card-gizi position-relative">
                        <i class="fas fa-flask"></i>
                        <h3 id="uji-nilai-gizi">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>Uji Nilai Gizi</p>
                        <small>Produk yang diuji nilai gizi</small>
                    </div>

                    <!-- Kurasi Produk -->
                    <div class="dashboard-card card-kurasi position-relative">
                        <i class="fas fa-star"></i>
                        <h3 id="kurasi-produk">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>Kurasi Produk</p>
                        <small>Produk yang dikurasi</small>
                    </div>

                    <!-- Pelatihan Pemberdayaan -->
                    <div class="dashboard-card card-pelatihan position-relative">
                        <i class="fas fa-graduation-cap"></i>
                        <h3 id="pelatihan-pemberdayaan">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>Pelatihan Pemberdayaan</p>
                        <small>Program pelatihan yang tersedia</small>
                    </div>

                    <!-- Total Peserta Pelatihan -->
                    <div class="dashboard-card card-peserta position-relative">
                        <i class="fas fa-users"></i>
                        <h3 id="total-peserta-pelatihan">
                            <span class="loading-spinner"></span>
                        </h3>
                        <p>Total Peserta Pelatihan</p>
                        <small>Peserta yang mengikuti pelatihan</small>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-bolt"></i> Aksi Cepat</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-2">
                                        <a href="ikm-binaan.html" class="btn btn-primary btn-block w-100">
                                            <i class="fas fa-plus"></i> Tambah IKM Binaan
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <a href="inputan-layanan.html" class="btn btn-success btn-block w-100">
                                            <i class="fas fa-cogs"></i> Input Layanan
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <a href="pelatihan.html" class="btn btn-info btn-block w-100">
                                            <i class="fas fa-graduation-cap"></i> Kelola Pelatihan
                                        </a>
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <a href="penelusuran.html" class="btn btn-warning btn-block w-100">
                                            <i class="fas fa-search"></i> Cari Data
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-clock"></i> Aktivitas Terbaru</h5>
                            </div>
                            <div class="card-body">
                                <div id="recent-activity">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-spinner fa-spin"></i> Memuat aktivitas terbaru...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../shared/script-fixed.js"></script>
    
    <script>
        // Load recent activity
        const loadRecentActivity = async () => {
            try {
                const activities = await getData('activity-logs');
                const recentActivities = activities.slice(-5).reverse(); // Get last 5 activities
                
                let html = '';
                if (recentActivities.length === 0) {
                    html = '<div class="text-center text-muted">Belum ada aktivitas terbaru</div>';
                } else {
                    recentActivities.forEach(activity => {
                        const time = formatDate(activity.timestamp);
                        html += `
                            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                                <div>
                                    <strong>${activity.action || 'Aktivitas'}</strong>
                                    <br>
                                    <small class="text-muted">${activity.details?.method || ''} ${activity.details?.endpoint || ''}</small>
                                </div>
                                <small class="text-muted">${time}</small>
                            </div>
                        `;
                    });
                }
                
                document.getElementById('recent-activity').innerHTML = html;
            } catch (error) {
                document.getElementById('recent-activity').innerHTML = 
                    '<div class="text-center text-muted">Gagal memuat aktivitas terbaru</div>';
            }
        };
        
        // Load recent activity after dashboard data
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadRecentActivity, 1000);
        });
    </script>
</body>
</html>